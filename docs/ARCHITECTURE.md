# Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         HOMELAB MANAGEMENT SYSTEM                        â”‚
â”‚                              Version 2.0.0                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            CLIENT INTERFACES                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚                                        â”‚
â”‚    CLI CLIENT                   â”‚     TELEGRAM BOT                       â”‚
â”‚    (Lightweight Python)         â”‚     (Interactive Buttons)              â”‚
â”‚                                 â”‚                                        â”‚
â”‚    Commands:                    â”‚     Features:                          â”‚
â”‚    â€¢ lab server list            â”‚     â€¢ ğŸ–¥ï¸ Servers (button)             â”‚
â”‚    â€¢ lab on <server>            â”‚     â€¢ ğŸ”Œ Plugs (button)               â”‚
â”‚    â€¢ lab off <server>           â”‚     â€¢ âš¡ Power On (button)            â”‚
â”‚    â€¢ lab plug add ...           â”‚     â€¢ ğŸ”´ Power Off (button)           â”‚
â”‚    â€¢ lab config ...             â”‚     â€¢ Real-time updates               â”‚
â”‚                                 â”‚     â€¢ User whitelist                   â”‚
â”‚    Config:                      â”‚     â€¢ Confirmation dialogs             â”‚
â”‚    â€¢ ~/.config/homelab-client/  â”‚                                        â”‚
â”‚    â€¢ HOMELAB_SERVER_URL         â”‚     Commands:                          â”‚
â”‚    â€¢ HOMELAB_API_KEY            â”‚     â€¢ /start - Main menu              â”‚
â”‚                                 â”‚     â€¢ /servers - List servers          â”‚
â”‚                                 â”‚     â€¢ /plugs - List plugs              â”‚
â”‚                                 â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   REST API      â”‚
                         â”‚   HTTP/JSON     â”‚
                         â”‚   API Key Auth  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            DOCKER CONTAINER                              â”‚
â”‚                        (homelab-server:latest)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      FASTAPI SERVER (Port 8000)                   â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚  Endpoints:                                                        â”‚  â”‚
â”‚  â”‚  â€¢ GET  /health              - Health check                       â”‚  â”‚
â”‚  â”‚  â€¢ GET  /plugs               - List plugs                         â”‚  â”‚
â”‚  â”‚  â€¢ POST /plugs               - Add plug                           â”‚  â”‚
â”‚  â”‚  â€¢ GET  /servers             - List servers (with status)         â”‚  â”‚
â”‚  â”‚  â€¢ POST /servers             - Add server                         â”‚  â”‚
â”‚  â”‚  â€¢ POST /power/on            - Power on server                    â”‚  â”‚
â”‚  â”‚  â€¢ POST /power/off           - Power off server                   â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚  Security: X-API-Key header required                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      TELEGRAM BOT                                 â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚  â€¢ Listens for Telegram updates                                   â”‚  â”‚
â”‚  â”‚  â€¢ Validates user IDs against whitelist                           â”‚  â”‚
â”‚  â”‚  â€¢ Processes button clicks and commands                           â”‚  â”‚
â”‚  â”‚  â€¢ Provides real-time feedback                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                       SERVICE LAYER                               â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  PlugService    â”‚  â”‚  ServerService   â”‚  â”‚  PowerService   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                  â”‚  â”‚                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ get_client()  â”‚  â”‚ â€¢ ping()         â”‚  â”‚ â€¢ power_on()    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ turn_on()     â”‚  â”‚ â€¢ send_wol()     â”‚  â”‚ â€¢ power_off()   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ turn_off()    â”‚  â”‚ â€¢ shutdown()     â”‚  â”‚ â€¢ monitor()     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ get_power()   â”‚  â”‚ â€¢ resolve()      â”‚  â”‚                 â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    CONFIGURATION                                  â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚  File: /app/data/config.json (persistent volume)                 â”‚  â”‚
â”‚  â”‚  {                                                                â”‚  â”‚
â”‚  â”‚    "plugs": {                                                     â”‚  â”‚
â”‚  â”‚      "plug-name": {"ip": "192.168.1.50"}                         â”‚  â”‚
â”‚  â”‚    },                                                             â”‚  â”‚
â”‚  â”‚    "servers": {                                                   â”‚  â”‚
â”‚  â”‚      "server-name": {                                             â”‚  â”‚
â”‚  â”‚        "hostname": "server.local",                                â”‚  â”‚
â”‚  â”‚        "mac": "AA:BB:CC:DD:EE:FF",                                â”‚  â”‚
â”‚  â”‚        "plug": "plug-name"                                        â”‚  â”‚
â”‚  â”‚      }                                                             â”‚  â”‚
â”‚  â”‚    }                                                              â”‚  â”‚
â”‚  â”‚  }                                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  Environment Variables:                                                  â”‚
â”‚  â€¢ TAPO_USERNAME, TAPO_PASSWORD - Tapo account credentials              â”‚
â”‚  â€¢ TELEGRAM_BOT_TOKEN - Bot token from @BotFather                       â”‚
â”‚  â€¢ TELEGRAM_USER_IDS - Comma-separated user IDs                         â”‚
â”‚  â€¢ API_KEY - Authentication key for REST API                            â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚             â”‚             â”‚
                    â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           HARDWARE LAYER                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚                       â”‚                       â”‚
â”‚   TAPO SMART PLUGS      â”‚     SERVERS           â”‚   NETWORK SERVICES    â”‚
â”‚   (P110 / P115)         â”‚                       â”‚                       â”‚
â”‚                         â”‚                       â”‚                       â”‚
â”‚   â€¢ 192.168.1.50        â”‚   â€¢ server1.local     â”‚   â€¢ DNS (nslookup)    â”‚
â”‚   â€¢ 192.168.1.51        â”‚   â€¢ server2.local     â”‚   â€¢ ICMP (ping)       â”‚
â”‚   â€¢ ...                 â”‚   â€¢ ...               â”‚   â€¢ SSH (shutdown)    â”‚
â”‚                         â”‚                       â”‚   â€¢ WOL (magic pkt)   â”‚
â”‚   Operations:           â”‚   Operations:         â”‚                       â”‚
â”‚   â€¢ Turn on/off         â”‚   â€¢ Wake-on-LAN       â”‚                       â”‚
â”‚   â€¢ Read power usage    â”‚   â€¢ Shutdown (SSH)    â”‚                       â”‚
â”‚   â€¢ Get device info     â”‚   â€¢ Status check      â”‚                       â”‚
â”‚                         â”‚                       â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


COMMUNICATION FLOW EXAMPLES:

1. CLI Power On:
   CLI â†’ REST API â†’ PowerService â†’ PlugService â†’ Tapo API â†’ Smart Plug
                                 â†’ ServerService â†’ WOL â†’ Server
                                 â†’ Monitor boot â†’ Return status â†’ CLI

2. Telegram Power Off:
   Bot â†’ User clicks button â†’ PowerService â†’ ServerService â†’ SSH shutdown
                                           â†’ PlugService â†’ Turn off plug
                                           â†’ Update message â†’ User sees result

3. Status Check:
   CLI/Bot â†’ REST API â†’ ServerService â†’ ping/nslookup â†’ Network
                      â†’ Return status â†’ Display to user


DEPLOYMENT:

   Host Machine
   â”œâ”€â”€ docker-compose up -d
   â”‚   â””â”€â”€ Creates container with:
   â”‚       â€¢ FastAPI server (port 8000)
   â”‚       â€¢ Telegram bot (polling)
   â”‚       â€¢ Volume: ./data â†’ /app/data
   â”‚       â€¢ Network: host mode (LAN access)
   â””â”€â”€ Health check every 30s


INSTALLATION:

   Server:  cd docker && docker-compose up -d
   Client:  cd client && ./install.sh
   Config:  Edit .env file, configure API keys


SECURITY:

   âœ“ API key authentication
   âœ“ Telegram user whitelist
   âœ“ Environment variables (no hardcoded secrets)
   âœ“ Docker isolation
   âœ“ SSH key authentication for shutdown
   âœ“ No credentials stored in code
```
